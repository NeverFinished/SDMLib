<html>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<body>
<p>Storyboard <a href='../examples/org/sdmlib/examples/studyright/StudyRightStoryboards.java' type='text/x-java'>BidirectionalModelToTextTransformation</a></p>
<p>BidirectionalModelToTextTransformation</p>
<p>Start: We start with the usual StudyRight object model.</p>
<embed type="image/svg+xml" src='BidirectionalModelToTextTransformation3.svg'>
<p><a name = 'step_1'>Step 1: Use text templates to generate a natural language description of the object model.</a></p><pre>      StringBuilder modelDescription = new StringBuilder();

      // first the university object itself
      String objectDescription = CGUtil.fill(
         "The example University has 99 rooms and 88 students:n", 
         "example", uni.getName(),
         "99", "" + uni.getRooms().size(),
         "88", "" + uni.getStudents().size());

      modelDescription.append(objectDescription);

      // now the rooms
      for (Room room : uni.getRooms())
      {
         objectDescription = CGUtil.fill(
            " - The roomName room has 42 credits. It is connected to rooms: roomListn", 
            "roomName", room.getRoomNo(),
            "42", "" + room.getCredits(), 
            "roomList", room.getNeighbors().getRoomNo().toString());

         modelDescription.append(objectDescription);
      }

      // now the students
      modelDescription.append("The students are:n");
      for (Student student : uni.getStudents())
      {
         objectDescription = CGUtil.fill(
            " - Lee has immatrikulation number 1234.n", 
            "Lee", student.getName(),
            "1234", "" + student.getMatrNo());

         if (student.getIn() != null)
         {
            objectDescription = CGUtil.fill(objectDescription, 
               ".", CGUtil.fill(" and is in the math room.", "math", student.getIn().getRoomNo()));
         }

         modelDescription.append(objectDescription);
      }

</pre><p>The resulting text: <pre>The StudyRight University has 5 rooms and 2 students:
 - The math room has 42 credits. It is connected to rooms: [arts, sports]
 - The arts room has 23 credits. It is connected to rooms: [math, sports, exam, ProgMeth]
 - The sports room has 23 credits. It is connected to rooms: [math, arts, exam]
 - The exam room has 0 credits. It is connected to rooms: [sports, arts, ProgMeth]
 - The ProgMeth room has 42 credits. It is connected to rooms: [arts, exam]
The students are:
 - Albert has immatrikulation number 4242 and is in the math room.
 - Nina has immatrikulation number 2323.
</pre></p>
<p><a name = 'step_2'>Step 2: Text to model.</a></p><pre>      String otherUniDescription = 
            "The Study False University has many rooms and some students:n" + 
                  " - The class diagrams room has 23 credits. It is connected to rooms: [laws, business]n" + 
                  " - The laws room has 24 credits. It is connected to rooms: [class diagrams, business]n" + 
                  " - The business room has 3 credits. It is connected to rooms: [laws, class diagrams]n" + 
                  "The students are:n" + 
                  " - Bart has immatrikulation number 111 and is in the laws room.n" + 
                  " - Rosi has immatrikulation number 112.n";

      LinkedHashMap<String, String> placeholderValues = CGUtil.find(otherUniDescription, 0,
         "The example University has 99 rooms and 88 students:n", 
         "example", 
         "99", 
            "88");

      String uniName = placeholderValues.get("example");

      University falseUni = new University().withName(uniName);

      // read rooms
      boolean match = true;
      int searchPos = Integer.valueOf(placeholderValues.get(CGUtil.SEARCH_POS));
      while (match)
      {
         placeholderValues = CGUtil.find(otherUniDescription, searchPos,
            " - The roomName room has 42 credits. It is connected to rooms: roomListn", 
            "roomName", 
            "42", 
               "roomList");

         match = placeholderValues.size() > 1;

         if (match)
         {
            searchPos = Integer.valueOf(placeholderValues.get(CGUtil.SEARCH_POS));

            Room room = falseUni.createRooms()
                  .withRoomNo(placeholderValues.get("roomName"))
                  .withCredits(Integer.valueOf(placeholderValues.get("42")));

            String[] roomNames = CGUtil.split(placeholderValues.get("roomList"));
            RoomSet neighbors = falseUni.getRooms().hasRoomNo(roomNames);
            room.withNeighbors(neighbors.toArray(new Room[] {}));
         }
      }

      // now the students
      if (otherUniDescription.startsWith("The students are:n", searchPos))
      {
         searchPos += "The students are:n".length();
         match = true;
         while (match)
         {
            placeholderValues = CGUtil.find(otherUniDescription, searchPos,
               " - Lee has immatrikulation number 1234.n", 
               "Lee", 
                  "1234");

            match = placeholderValues.size() > 1;

            if (match)
            {
               searchPos = Integer.valueOf(placeholderValues.get(CGUtil.SEARCH_POS));

               Student student = falseUni.createStudents()
                     .withName(placeholderValues.get("Lee"));

               String matrNo = placeholderValues.get("1234");

               placeholderValues = CGUtil.find(matrNo, 0,
                  "1234 and is in the math room", 
                  "1234", 
                     "math");

               if (placeholderValues.size() > 1)
               {
                  student.withMatrNo(Integer.valueOf(placeholderValues.get("1234")))
                  .withIn(falseUni.getRooms(placeholderValues.get("math")));
               }
               else
               {
                  student.withMatrNo(Integer.valueOf(matrNo));
               }
            }
         }
      }

</pre><p>Results in the following object structure:</p>
<embed type="image/svg+xml" src='BidirectionalModelToTextTransformation10.svg'>

</body>
</html>
