<html>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<link rel="stylesheet" type="text/css" href="style.css">
<body>
<p>Storyboard <a href='../examples/org/sdmlib/examples/studyright/StudyRightStoryboards.java' type='text/x-java'>BidirectionalModelToTextTransformation</a></p>
<p>BidirectionalModelToTextTransformation</p>
<p>Start: We start with the usual StudyRight object model.</p>
<embed type="image/svg+xml" src='BidirectionalModelToTextTransformation3.svg'>
<p><a name = 'step_1'>Step 1: Use text templates to generate a natural language description of the object model.</a></p><pre>      StringBuilder modelDescription = new StringBuilder();

      &#x2F;&#x2F; first the university object itself
      String objectDescription = CGUtil.fill(
         &quot;The example University has 99 rooms and 88 students:n&quot;, 
         &quot;example&quot;, uni.getName(),
         &quot;99&quot;, &quot;&quot; + uni.getRooms().size(),
         &quot;88&quot;, &quot;&quot; + uni.getStudents().size());

      modelDescription.append(objectDescription);

      &#x2F;&#x2F; now the rooms
      for (Room room : uni.getRooms())
      {
         objectDescription = CGUtil.fill(
            &quot; - The roomName room has 42 credits. It is connected to rooms: roomListn&quot;, 
            &quot;roomName&quot;, room.getRoomNo(),
            &quot;42&quot;, &quot;&quot; + room.getCredits(), 
            &quot;roomList&quot;, room.getNeighbors().getRoomNo().toString());

         modelDescription.append(objectDescription);
      }

      &#x2F;&#x2F; now the students
      modelDescription.append(&quot;The students are:n&quot;);
      for (Student student : uni.getStudents())
      {
         objectDescription = CGUtil.fill(
            &quot; - Lee has immatrikulation number 1234.n&quot;, 
            &quot;Lee&quot;, student.getName(),
            &quot;1234&quot;, &quot;&quot; + student.getMatrNo());

         if (student.getIn() != null)
         {
            objectDescription = CGUtil.fill(objectDescription, 
               &quot;.&quot;, CGUtil.fill(&quot; and is in the math room.&quot;, &quot;math&quot;, student.getIn().getRoomNo()));
         }

         modelDescription.append(objectDescription);
      }

</pre><p>The resulting text: <pre>The StudyRight University has 5 rooms and 2 students:
 - The math room has 42 credits. It is connected to rooms: (arts, sports)
 - The arts room has 23 credits. It is connected to rooms: (math, sports, exam, ProgMeth)
 - The sports room has 23 credits. It is connected to rooms: (math, arts, exam)
 - The exam room has 0 credits. It is connected to rooms: (sports, arts, ProgMeth)
 - The ProgMeth room has 42 credits. It is connected to rooms: (arts, exam)
The students are:
 - Albert has immatrikulation number 4242 and is in the math room.
 - Nina has immatrikulation number 2323.
</pre></p>
<p><a name = 'step_2'>Step 2: Text to model.</a></p><pre>      String otherUniDescription = 
            &quot;The Study False University has many rooms and some students:n&quot; + 
                  &quot; - The class diagrams room has 23 credits. It is connected to rooms: [laws, business]n&quot; + 
                  &quot; - The laws room has 24 credits. It is connected to rooms: [class diagrams, business]n&quot; + 
                  &quot; - The business room has 3 credits. It is connected to rooms: [laws, class diagrams]n&quot; + 
                  &quot;The students are:n&quot; + 
                  &quot; - Bart has immatrikulation number 111 and is in the laws room.n&quot; + 
                  &quot; - Rosi has immatrikulation number 112.n&quot;;

      LinkedHashMap&lt;String, String&gt; placeholderValues = CGUtil.find(otherUniDescription, 0,
         &quot;The example University has 99 rooms and 88 students:n&quot;, 
         &quot;example&quot;, 
         &quot;99&quot;, 
            &quot;88&quot;);

      String uniName = placeholderValues.get(&quot;example&quot;);

      University falseUni = new University().withName(uniName);

      &#x2F;&#x2F; read rooms
      boolean match = true;
      int searchPos = Integer.valueOf(placeholderValues.get(CGUtil.SEARCH_POS));
      while (match)
      {
         placeholderValues = CGUtil.find(otherUniDescription, searchPos,
            &quot; - The roomName room has 42 credits. It is connected to rooms: roomListn&quot;, 
            &quot;roomName&quot;, 
            &quot;42&quot;, 
               &quot;roomList&quot;);

         match = placeholderValues.size() &gt; 1;

         if (match)
         {
            searchPos = Integer.valueOf(placeholderValues.get(CGUtil.SEARCH_POS));

            Room room = falseUni.createRooms()
                  .withRoomNo(placeholderValues.get(&quot;roomName&quot;))
                  .withCredits(Integer.valueOf(placeholderValues.get(&quot;42&quot;)));

            String[] roomNames = CGUtil.split(placeholderValues.get(&quot;roomList&quot;));
            RoomSet neighbors = falseUni.getRooms().hasRoomNo(roomNames);
            room.withNeighbors(neighbors.toArray(new Room[] {}));
         }
      }

      &#x2F;&#x2F; now the students
      if (otherUniDescription.startsWith(&quot;The students are:n&quot;, searchPos))
      {
         searchPos += &quot;The students are:n&quot;.length();
         match = true;
         while (match)
         {
            placeholderValues = CGUtil.find(otherUniDescription, searchPos,
               &quot; - Lee has immatrikulation number 1234.n&quot;, 
               &quot;Lee&quot;, 
                  &quot;1234&quot;);

            match = placeholderValues.size() &gt; 1;

            if (match)
            {
               searchPos = Integer.valueOf(placeholderValues.get(CGUtil.SEARCH_POS));

               Student student = falseUni.createStudents()
                     .withName(placeholderValues.get(&quot;Lee&quot;));

               String matrNo = placeholderValues.get(&quot;1234&quot;);

               placeholderValues = CGUtil.find(matrNo, 0,
                  &quot;1234 and is in the math room&quot;, 
                  &quot;1234&quot;, 
                     &quot;math&quot;);

               if (placeholderValues.size() &gt; 1)
               {
                  student.withMatrNo(Integer.valueOf(placeholderValues.get(&quot;1234&quot;)))
                  .withIn(falseUni.getRooms(placeholderValues.get(&quot;math&quot;)));
               }
               else
               {
                  student.withMatrNo(Integer.valueOf(matrNo));
               }
            }
         }
      }

</pre><p>Results in the following object structure:</p>
<embed type="image/svg+xml" src='BidirectionalModelToTextTransformation10.svg'>

</body>
</html>
