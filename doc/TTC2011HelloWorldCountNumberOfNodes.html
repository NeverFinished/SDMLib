<html>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<body>
<p>Scenario <a href='../examples/org/sdmlib/examples/helloworld/HelloWorldTTC2011.java' type='text/x-java'>TTC2011HelloWorldCountNumberOfNodes</a></p>
<hr/><pre>Simple Graph application classes: </pre>
<embed type="image/svg+xml" src='TTC2011HelloWorldSimpleGraphClassDiag.svg'><hr/><pre>create example graph: </pre>
<embed type="image/svg+xml" src='TTC2011HelloWorldCountNumberOfNodes7.svg'>
<hr/><h2>Count nodes in graph direct: </h2><pre>   public void countNodesInJava(Graph graph)
   {
      int noOfNodes = graph.getNodes().size();
      
      systemout = "Number of nodes: " + noOfNodes;
   }</pre>
<pre>systemout: Number of nodes: 8</pre>
<pre>Count nodes in graph per pattern: </pre>
<pre>   public void countNodesPerPattern(Graph graph)
   {
      ModelPattern p = new ModelPattern();
      
      GraphPO graphPO = p.hasElementGraphPO(graph);
      
      NodePO nodePO = graphPO.hasNodes();
      
      int noOfNodes = p.allMatches();
      
      systemout = "Number of nodes: " + noOfNodes;
   }</pre>
<embed type="image/svg+xml"src='countNodesPerPatternRule.svg'>
<embed type="image/svg+xml"src='countNodesPerPatternRuleWithMatch.svg'>
<pre>systemout: Number of nodes: 8</pre>
<pre>Retrieve set of matching nodes per pattern and count its elements: </pre>
<pre>   public void countNodesPerNodeSet(Graph graph)
   {
      NodeSet allMatches = new ModelPattern()
      .hasElementGraphPO(graph)
      .hasNodes()
      .allMatches();
      
      systemout = "Nodes: " + allMatches.getName().concat(", ") + " Number of nodes: " + allMatches.size();      
   }</pre>
<embed type="image/svg+xml"src='countNodesPerNodeSet.svg'>
<embed type="image/svg+xml"src='countNodesPerNodeSetWithMatch.svg'>
<pre>systemout: Nodes: n1, n2, n3, n4, n5, n6, n7, n8 Number of nodes: 8</pre>
<hr/><h2>Retrieve set of looping edges per pattern and count its elements: </h2><pre>   public void countLoopingEdgesPerPattern(Graph graph)
   {
      EdgePO edgesPO = new ModelPattern()
      .hasElementGraphPO(graph)
      .hasEdges();
      
      NodePO srcPO = edgesPO.hasSrc();
      
      edgesPO.hasTgt(srcPO);
      
      EdgeSet loopingEdges = edgesPO.allMatches();
      
      systemout = "Looping Edges: " + loopingEdges.getName().concat(", ") + " Number of looping edges: " + loopingEdges.size();
   }</pre>
<embed type="image/svg+xml"src='countLoopingEdgesPerPattern.svg'>
<embed type="image/svg+xml"src='countLoopingEdgesPerPatternWithMatch.svg'>
<pre>systemout: Looping Edges: e16, e17 Number of looping edges: 2</pre>
<pre>For comparison a Java solution: </pre>
<pre>   public void countLoopingEdgesInJava(Graph graph)
   {
      String sysout = "Looping Edges: ";
      
      int noOfLoopingEdges = 0;
      
      for (Edge edge : graph.getEdges())
      {
         if (edge.getSrc() != null && edge.getSrc() == edge.getTgt())
         {
            noOfLoopingEdges++;
            
            sysout += edge.getName() + ", ";
         }
      }
      
      systemout = sysout.substring(0, sysout.length() - 2) + " Number of looping edges: " + noOfLoopingEdges;
   }</pre>
<pre>systemout: Looping Edges: e16, e17 Number of looping edges: 2</pre>
<hr/><h2>Retrieve isolated nodes and count them: </h2><pre>   public ModelPattern countIsolatedNodesPerPattern(Graph graph)
   {
      ModelPattern p = new ModelPattern();
      
      GraphPO graphPO = p.hasElementGraphPO(graph);
      
      NodePO nodePO = graphPO.hasNodes();
      
      nodePO.startNAC().hasOutEdges().endNAC();
      
      nodePO.startNAC().hasInEdges().endNAC();

      NodeSet isolatedNodes = nodePO.allMatches();
      
      systemout = "Isolated nodes: " + isolatedNodes.getName().concat(", ") + " Number of isolated nodes: " + isolatedNodes.size();
      
      return p;
   }</pre>
<embed type="image/svg+xml"src='countIsolatedNodesPerPattern.svg'>
<embed type="image/svg+xml"src='countIsolatedNodesPerPatternWithMatch.svg'>
<pre>systemout: Isolated nodes: n6, n7 Number of isolated nodes: 2</pre>
<pre>For comparison a Java solution: </pre>
<pre>   public void countIsolatedNodesInJava(Graph graph)
   {
      systemout = "Isolated nodes: ";
      
      int noOfIsolatedNodes = 0;
      
      for (Node isoNode : graph.getNodes())
      {
         if (isoNode.getOutEdges().size() == 0 
               && isoNode.getInEdges().size() == 0)
         {
            noOfIsolatedNodes++;
            
            systemout += isoNode.getName() + ", ";
         }
      }
      
      systemout = systemout.substring(0, systemout.length() - 2) + " Number of isolated nodes: " + noOfIsolatedNodes;
   }</pre>
<pre>systemout: Isolated nodes: n6, n7 Number of isolated nodes: 2</pre>
<hr/><h2>Count circles of three nodes: </h2><pre>   public ModelPattern countCirclesOfThreeNodesPerPattern(Graph graph)
   {
      ModelPattern p = new ModelPattern();
      
      GraphPO graphPO = p.hasElementGraphPO(graph);
      
      NodePO firstCircleNodePO = graphPO.hasNodes();
      
      NodePO secondCircleNodePO = firstCircleNodePO.hasOutEdges().hasTgt();
      
      NodePO thirdCircleNodePO = secondCircleNodePO.hasOutEdges().hasTgt();
      
      thirdCircleNodePO.hasOutEdges().hasTgt(firstCircleNodePO);
      
      p.matchIsomorphic();
      
      int noOfCircles = p.allMatches();
      
      systemout = "Circles found: " + noOfCircles;
      
      return p;
   }</pre>
<embed type="image/svg+xml"src='countCirclesOfThreeNodesPerPattern.svg'>
<embed type="image/svg+xml"src='countCirclesOfThreeNodesPerPatternWithMatch.svg'>
<pre>systemout: Circles found: 6</pre>
<pre>If you want to print the matched nodes for each circle, you need to iterate through the matches: </pre>
<pre>   public ModelPattern countCirclesOfThreeNodesPerPatternReportMatches(Graph graph)
   {
      ModelPattern p = new ModelPattern();
      
      GraphPO graphPO = p.hasElementGraphPO(graph);
      
      NodePO firstCircleNodePO = graphPO.hasNodes();
      
      NodePO secondCircleNodePO = firstCircleNodePO.hasOutEdges().hasTgt();
      
      NodePO thirdCircleNodePO = secondCircleNodePO.hasOutEdges().hasTgt();
      
      thirdCircleNodePO.hasOutEdges().hasTgt(firstCircleNodePO);
      
      p.matchIsomorphic();
      
      systemout = "Circles found: n";
      int noOfCircles = 0;
      
      while (p.getHasMatch())
      {
         systemout += firstCircleNodePO.getName() + " --> "
               + secondCircleNodePO.getName() + " --> " 
               + thirdCircleNodePO.getName() + " --> n";
         
         noOfCircles++; 
         
         p.findNextMatch();
      }
      
      systemout += "" + noOfCircles + " circles found";
      
      return p;
   }</pre>
<embed type="image/svg+xml"src='countCirclesOfThreeNodesPerPatternReportMatches.svg'>
<embed type="image/svg+xml"src='countCirclesOfThreeNodesPerPatternReportMatchesWithMatch.svg'>
<pre>systemout: Circles found: 
n1 --> n2 --> n3 --> 
n2 --> n3 --> n1 --> 
n3 --> n1 --> n2 --> 
n3 --> n4 --> n5 --> 
n4 --> n5 --> n3 --> 
n5 --> n3 --> n4 --> 
6 circles found</pre>
<pre>Just for comparison, a plain java implementation: </pre>
<pre>   public void countCirclesOfThreeNodesInJava(Graph graph)
   {
      int noOfCircles = 0;
      
      systemout = "Circles found: n";
      
      for (Node firstNode : graph.getNodes())
      {
         for (Edge firstEdge : firstNode.getOutEdges())
         {
            Node secondNode = firstEdge.getTgt();
            
            if (secondNode != null && secondNode != firstNode)
            {
               for (Edge secondEdge : secondNode.getOutEdges())
               {
                  Node thirdNode = secondEdge.getTgt();
            
                  if (thirdNode != null && thirdNode != secondNode && thirdNode != firstNode)
                  {
                     for (Edge thirdEdge : thirdNode.getOutEdges())
                     {
                        if (thirdEdge.getTgt() == firstNode)
                        {
                           // found match
                           systemout += firstNode.getName() + " --> "
                                 + secondNode.getName() + " --> " 
                                 + thirdNode.getName() + " --> n";
                           
                           noOfCircles++;
                        }
                     }
                  }
               }
            }
         }
      }
      
      systemout += "" + noOfCircles + " circles found";
   }</pre>
<pre>systemout: Circles found: 
n1 --> n2 --> n3 --> 
n2 --> n3 --> n1 --> 
n3 --> n1 --> n2 --> 
n3 --> n4 --> n5 --> 
n4 --> n5 --> n3 --> 
n5 --> n3 --> n4 --> 
6 circles found</pre>
<hr/><h2>Count dangling edges per pattern: </h2><pre>   public ModelPattern countDanglingEdgesPerPattern(Graph graph)
   {
      ModelPattern p = new ModelPattern();
      
      EdgePO edgePO = p.hasElementGraphPO(graph).hasEdges();
      
      edgePO.startNAC().hasTgt();
      
      edgePO.hasSrc().endNAC();
      
      EdgeSet allMatches = edgePO.allMatches();
      
      systemout = "Dangling edges " + allMatches.getName().concat(", ") + " number: " + allMatches.size();
      
      return p;
   }</pre>
<embed type="image/svg+xml"src='countDanglingEdgesPerPattern.svg'>
<embed type="image/svg+xml"src='countDanglingEdgesPerPatternWithMatch.svg'>
<pre>systemout: Dangling edges e18, e19 number: 2</pre>
<pre>Count dangling edges in Java: </pre>
<pre>   public void countDanglingEdgesInJava(Graph graph)
   {
      systemout = "Dangling edges "; 
      
      int noOfMatches = 0;
      
      for (Edge edge : graph.getEdges())
      {
         if (edge.getSrc() == null
               || edge.getTgt() == null)
         {
            systemout += edge.getName() + ", ";
            
            noOfMatches++;
         }
      }
      
      systemout = systemout.substring(0, systemout.length() - 2) + " number: " + noOfMatches;
   }</pre>
<pre>systemout: Dangling edges e18, e19 number: 2</pre>

</body>
</html>
