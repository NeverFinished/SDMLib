<html>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<body>
<p>Storyboard <a href='../examples/org/sdmlib/examples/helloworld/HelloWorldTTC2011.java' type='text/x-java'>TTC2011SimpleMigration</a></p>
<p>TTC2011SimpleMigration</p>
<hr/><p>Source model:</p>
<embed type="image/svg+xml" src='TTC2011HelloWorldSimpleMigrationSourceClassDiag.svg'><hr/><p>Target model:</p>
<embed type="image/svg+xml" src='TTC2011SimpleMigrationClassDiagram6.svg'><hr/><p>Migration extension:</p>
<embed type="image/svg+xml" src='TTC2011SimpleMigrationClassDiagram9.svg'><hr/><p>Create example source graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration13.svg'>
<hr/><h2>Migrate per pattern: </h2><pre>   private void simpleMigrationPerPattern(Graph graph, Storyboard storyboard)
   {
      //==========================================================================
      ModelPattern migrateGraph = new ModelPattern();
      
      GraphPO srcGraphPO = migrateGraph.hasElementGraphPO(graph);
      
      migrateGraph.startCreate();
      
      GraphPO tgtGraphPO = migrateGraph.hasElementGraphPO();
      
      storyboard.add(migrateGraph.dumpDiagram("simpleMigrationPerPattern_migrateGraph", false));
      
      //==========================================================================
      int noOfMatches = 0;
      
      ModelPattern migrateNodesPattern = new ModelPattern();
      
      srcGraphPO = migrateNodesPattern.hasElementGraphPO(graph);
      
      NodePO srcNodePO = srcGraphPO.hasNodes();
      
      tgtGraphPO = migrateNodesPattern.hasElementGraphPO(tgtGraphPO.getCurrentMatch());
      
      migrateNodesPattern.startCreate();
      
      NodePO tgtNodePO = tgtGraphPO.hasGcsNode();
      
      tgtNodePO.hasOrig(srcNodePO);
      
      while (migrateNodesPattern.getHasMatch())
      {
         tgtNodePO.withText(srcNodePO.getName());
         
         noOfMatches++;
         
         migrateNodesPattern.findNextMatch();
      }
      
      systemout = "Number of migrated nodes: " + noOfMatches;
      
      storyboard.add(migrateNodesPattern.dumpDiagram("simpleMigrationPerPattern_migrateNodesPattern", false));
      
      //==========================================================================
      noOfMatches = 0;
      
      ModelPattern migrateEdgesPattern = new ModelPattern();
      
      srcGraphPO = migrateEdgesPattern.hasElementGraphPO(graph);
      
      EdgePO srcEdgePO = srcGraphPO.hasEdges();
      
      tgtGraphPO = migrateEdgesPattern.hasElementGraphPO(tgtGraphPO.getCurrentMatch());
      
      migrateEdgesPattern.startCreate();
      
      EdgePO tgtEdgePO = tgtGraphPO.hasGcsEdge();
      
      ModelPattern migrateSrcHalfLinkPattern = null;
      ModelPattern migrateTgtHalfLinkPattern = null;
      
      while (migrateEdgesPattern.getHasMatch())
      {
         tgtEdgePO.withText(srcEdgePO.getName());
      
         migrateSrcHalfLinkPattern = new ModelPattern();
         
         NodePO copySrcNodePO = migrateSrcHalfLinkPattern.hasElementEdgePO(srcEdgePO.getCurrentMatch())
         .hasSrc()
         .hasCopy();
         
         EdgePO copyEdgePO = migrateSrcHalfLinkPattern.hasElementEdgePO(tgtEdgePO.getCurrentMatch());
         
         migrateSrcHalfLinkPattern.startCreate();
         
         copyEdgePO.hasSrc(copySrcNodePO);
         

         migrateTgtHalfLinkPattern = new ModelPattern();
         
         NodePO copyTgtNodePO = migrateTgtHalfLinkPattern.hasElementEdgePO(srcEdgePO.getCurrentMatch())
         .hasTgt()
         .hasCopy();
         
         EdgePO copyEdgePO2 = migrateTgtHalfLinkPattern.hasElementEdgePO(tgtEdgePO.getCurrentMatch());
         
         migrateTgtHalfLinkPattern.startCreate();
         
         copyEdgePO2.hasTgt(copyTgtNodePO);
         
         noOfMatches++;
         
         migrateEdgesPattern.findNextMatch();
      }

      systemout += "nNumber of migrated Edges: " + noOfMatches;
      
      storyboard.add(migrateEdgesPattern.dumpDiagram("simpleMigrationPerPattern_migrateEdgesPattern", false));
      
      storyboard.add(migrateSrcHalfLinkPattern.dumpDiagram("simpleMigrationPerPattern_migrateSrcHalfLinkPattern", false));
      
      storyboard.add(migrateTgtHalfLinkPattern.dumpDiagram("simpleMigrationPerPattern_migrateTgtHalfLinkPattern", false));
   }</pre><embed type="image/svg+xml"src='simpleMigrationPerPattern_migrateGraph.svg'>
<embed type="image/svg+xml"src='simpleMigrationPerPattern_migrateNodesPattern.svg'>
<embed type="image/svg+xml"src='simpleMigrationPerPattern_migrateEdgesPattern.svg'>
<embed type="image/svg+xml"src='simpleMigrationPerPattern_migrateSrcHalfLinkPattern.svg'>
<embed type="image/svg+xml"src='simpleMigrationPerPattern_migrateTgtHalfLinkPattern.svg'>
<p>Result graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration23.svg'>
<p>Number of migrated nodes: 7
Number of migrated Edges: 9</p>
<hr/><h2>Migrate in Java: </h2><pre>   private void simpleMigrationInJava(Graph origGraph)
   {
      int noOfMatches = 0;
      
      if (origGraph != null)
      {
         Graph copyGraph = new Graph();
         
         // migrate nodes
         for (Node origNode : origGraph.getNodes())
         {
            Node copyNode = (Node) copyGraph.createGcsNode()
                  .withOrig(origNode)
                  .withText(origNode.getName());
            
            noOfMatches++;
         }

         systemout = "Number of migrated nodes: " + noOfMatches;
         
         // migrate edges
         for (Edge origEdge : origGraph.getEdges())
         {
            Edge copyEdge = (Edge) copyGraph.createGcsEdge()
                  .withText(origEdge.getName());
            
            Node origSrcNode = origEdge.getSrc();
            
            if (origSrcNode != null)
            {
               copyEdge.setSrc(origSrcNode.getCopy());
            }

            Node origTgtNode = origEdge.getTgt();
            
            if (origTgtNode != null)
            {
               copyEdge.setTgt(origTgtNode.getCopy());
            }
         }
      }
      
   }</pre><p>Result graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration29.svg'>
<p>Number of migrated nodes: 8</p>
<hr/><h2>Migrate using Serialisation / Clone : </h2><pre>   private Graph simpleMigrationByCloning(Graph graph)
   {
      JsonArray jsonArray = CreatorCreator.createIdMap("hg").toJsonArray(graph);
      
      Graph copyGraph = (Graph) CreatorCreator.createIdMap("hg").decode(jsonArray);
      
      GraphComponentSet gcs = new GraphComponentSet();
      gcs.addAll(copyGraph.getNodes());
      gcs.addAll(copyGraph.getEdges());
      
      for (GraphComponent comp : gcs)
      {
         comp.setParent(comp.getGraph());
         comp.setGraph(null);
         
         comp.setText(comp.getName());
         comp.setName(null);
      }

      return copyGraph;
   }</pre><p>Result graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration35.svg'>
<hr/><h2>Migrate using JSON Array reprï¿½sentation : </h2><pre>   private Graph simpleMigrationByJsonArray(Graph graph)
   {
      JsonIdMap idMap = CreatorCreator.createIdMap("hg");
      
      JsonArray jsonArray = idMap.toJsonArray(graph);
      
      for (int i = 0; i < jsonArray.size(); i++)
      {
         JsonObject jsonObject = jsonArray.getJSONObject(i);
         
         String className = jsonObject.getString(JsonIdMap.CLASS);
         
         if (Graph.class.getName().equals(className))
         {
            JsonObject jsonProps = jsonObject.getJsonObject(JsonIdMap.JSON_PROPS);
            
            // migrate nodes and edges to gcs
            JsonArray gcsArray = jsonProps.getJsonArray(Graph.PROPERTY_NODES);
            
            gcsArray.addAll(Arrays.asList(jsonProps.getJsonArray(Graph.PROPERTY_EDGES).toArray()));
            
            jsonProps.put(Graph.PROPERTY_GCS, gcsArray);
            
            jsonProps.remove(Graph.PROPERTY_NODES);
            
            jsonProps.remove(Graph.PROPERTY_EDGES);
         }
         else if (Node.class.getName().equals(className))
         {
            JsonObject jsonProps = jsonObject.getJsonObject(JsonIdMap.JSON_PROPS);
            
            // migrate name to text
            jsonProps.put(Node.PROPERTY_TEXT, jsonProps.get(Node.PROPERTY_NAME));
            
            jsonProps.remove(Node.PROPERTY_NAME);
            
            // migrate graph to parent
            jsonProps.put(Node.PROPERTY_PARENT, jsonProps.get(Node.PROPERTY_GRAPH));
            
            jsonProps.remove(Node.PROPERTY_GRAPH);
         }
         else if (Edge.class.getName().equals(className))
         {
            JsonObject jsonProps = jsonObject.getJsonObject(JsonIdMap.JSON_PROPS);

            // migrate name to text
            jsonProps.put(Node.PROPERTY_TEXT, jsonProps.get(Node.PROPERTY_NAME));

            jsonProps.remove(Node.PROPERTY_NAME);

            // migrate graph to parent
            jsonProps.put(Node.PROPERTY_PARENT, jsonProps.get(Node.PROPERTY_GRAPH));

            jsonProps.remove(Node.PROPERTY_GRAPH);
         }
         
      }
      
      Graph copyGraph = (Graph) CreatorCreator.createIdMap("hg").decode(jsonArray);
      
      return copyGraph;
   }</pre><p>Result graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration40.svg'>
<hr/><h2>Migrate using Generic Graph representation : </h2><pre>   private Graph simpleMigrationByGenericGraph(Graph origGraph, Storyboard storyboard)
   {
      GenericGraph genGraph = new Specific2Generic()
      .convert(CreatorCreator.createIdMap("g1"), origGraph);
      
      storyboard.addObjectDiagram(org.sdmlib.models.objects.creators.CreatorCreator.createIdMap("gg"), genGraph);
      
      // rename name to text attributes
      new org.sdmlib.models.objects.creators.ModelPattern()
      .hasElementGenericGraphPO(genGraph)
      .hasObjects()
      .hasAttrs()
      .hasName(Node.PROPERTY_NAME)
      .startCreate()
      .hasName(Node.PROPERTY_TEXT)
      .allMatches();
      
      storyboard.add(org.sdmlib.models.objects.creators.ModelPattern.lastPattern.dumpDiagram("simpleMigrationByGenericGraph_renameAttr", false));
      
      // rename graph--nodes links to parent--gcs links
      new org.sdmlib.models.objects.creators.ModelPattern()
      .hasElementGenericGraphPO(genGraph)
      .hasLinks()
      .hasTgtLabel(Node.PROPERTY_GRAPH)
      .startCreate()
      .hasTgtLabel(Node.PROPERTY_PARENT)
      .hasSrcLabel(Graph.PROPERTY_GCS)
      .allMatches();
      
      storyboard.add(org.sdmlib.models.objects.creators.ModelPattern.lastPattern.dumpDiagram("simpleMigrationByGenericGraph_renameLink", false));

      storyboard.addObjectDiagram(org.sdmlib.models.objects.creators.CreatorCreator.createIdMap("gg"), genGraph);
      
      Graph tgtGraph = (Graph) new Generic2Specific().convert(CreatorCreator.createIdMap("tg"), null, genGraph);
      
      return tgtGraph;
   }</pre><embed type="image/svg+xml" src='TTC2011SimpleMigration44.svg'>
<embed type="image/svg+xml"src='simpleMigrationByGenericGraph_renameAttr.svg'>
<embed type="image/svg+xml"src='simpleMigrationByGenericGraph_renameLink.svg'>
<embed type="image/svg+xml" src='TTC2011SimpleMigration47.svg'>
<p>Result graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration49.svg'>
<hr/><h2>Even more evolved graph model : </h2><embed type="image/svg+xml" src='TTC2011HelloWorldSimpleMigrationEvenMoreEvolvedDiag.svg'><embed type="image/svg+xml" src='TTC2011SimpleMigration53.svg'>
<pre>   private Graph simpleMigrationToEvenMoreEvolvedGraphByGenericGraph(Graph origGraph, Storyboard storyboard)
   {
      GenericGraph genGraph = new Specific2Generic()
      .convert(CreatorCreator.createIdMap("g1"), origGraph);
      
      // rename name to text attributes
      new org.sdmlib.models.objects.creators.ModelPattern()
      .hasElementGenericGraphPO(genGraph)
      .hasObjects()
      .hasAttrs()
      .hasName(Node.PROPERTY_NAME)
      .startCreate()
      .hasName(Node.PROPERTY_TEXT)
      .allMatches();
      
      storyboard.add(org.sdmlib.models.objects.creators.ModelPattern.lastPattern.dumpDiagram("simpleMigrationToEvenMoreEvolvedGraphByGenericGraph_renameAttr", false));
      
      // replace n.l.e.l.n by n.l.n
      GenericObjectPO edgePO = new org.sdmlib.models.objects.creators.ModelPattern()
      .hasElementGenericGraphPO(genGraph)
      .hasObjects()
      .hasType(Edge.class.getName());
      
      GenericLinkPO srcLinkPO = edgePO.hasOutgoingLinks().hasTgtLabel(Edge.PROPERTY_SRC);
      
      GenericLinkPO tgtLinkPO = edgePO.hasOutgoingLinks().hasTgtLabel(Edge.PROPERTY_TGT);
      
      GenericObjectPO srcNodePO = srcLinkPO.hasTgt();
      
      GenericObjectPO tgtNodePO = tgtLinkPO.hasTgt();
      
      edgePO.destroy(); 
      
      srcLinkPO.destroy();
      
      GenericLinkSet allMatches = tgtLinkPO.startCreate()
      .hasSrc(srcNodePO)
      .hasSrcLabel(Node.PROPERTY_LINKSFROM)
      .hasTgtLabel(Node.PROPERTY_LINKSTO)
      .allMatches();
      
      storyboard.add(org.sdmlib.models.objects.creators.ModelPattern.lastPattern.dumpDiagram("simpleMigrationToEvenMoreEvolvedGraphByGenericGraph_replaceEdges", false));
      
      // destroy dangling edges
      GenericObjectPO danglingPO = new org.sdmlib.models.objects.creators.ModelPattern()
      .hasElementGenericGraphPO(genGraph)
      .hasObjects()
      .hasType(Edge.class.getName());
      
      danglingPO.destroy();
      
      danglingPO.allMatches();
      
      storyboard.add(org.sdmlib.models.objects.creators.ModelPattern.lastPattern.dumpDiagram("simpleMigrationToEvenMoreEvolvedGraphByGenericGraph_removeDanglingEdges", false));
      
      Graph tgtGraph = (Graph) new Generic2Specific().convert(CreatorCreator.createIdMap("tg"), null, genGraph);
      
      return tgtGraph;
   }</pre><embed type="image/svg+xml"src='simpleMigrationToEvenMoreEvolvedGraphByGenericGraph_renameAttr.svg'>
<embed type="image/svg+xml"src='simpleMigrationToEvenMoreEvolvedGraphByGenericGraph_replaceEdges.svg'>
<embed type="image/svg+xml"src='simpleMigrationToEvenMoreEvolvedGraphByGenericGraph_removeDanglingEdges.svg'>
<p>Result graph: </p>
<embed type="image/svg+xml" src='TTC2011SimpleMigration59.svg'>

</body>
</html>
