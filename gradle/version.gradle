// MAJOR VERSION - Manually set
//----------------------
def majorVersion = 1
//----------------------

task printVersion {
    doFirst {
        println "$version"
    }
}

version = new Version(major: majorVersion, minor: getGitTag())
group = 'org.sdmlib'

class Version {
    int major, minor
    int revision = -1
    // change, if release is needed some day: boolean release
    // also change version above to accept release property
    boolean release = false

    String toString() {
		if (System.getenv().BUILD_NUMBER) {
			revision = System.getenv().BUILD_NUMBER as int
		}
        "$major.$minor.$revision${release ? '' : '-SNAPSHOT'}"
    }
}

def getGitTag() {
	try {
	    def stdout = new ByteArrayOutputStream()
    	exec {
    	    commandLine 'git', 'tag'
    	    standardOutput = stdout
    	}

    	def test = []
    
    	stdout.toString().eachLine {
			try {
			    test << (it.trim() as int)
			} catch (Exception ex) {
			    // no problem as long as there's another tag with a number
				ex.printStackTrace()
			}
    	}
    	test.max()
	} catch (Exception e) {
		e.printStackTrace()
		-1
	}
 }

